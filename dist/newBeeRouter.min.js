!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.NewBeeRouter=t():e.NewBeeRouter=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){function r(e){return function(t){return Object.prototype.toString.call(t)==="[object "+e+"]"}}function i(e,t){var n=e.match(t)||"";return n&&n.length&&n[1]&&(n=n[1]||""),n}function o(){function e(){var e=location.hash,t=location.href;setInterval(function(){if(e!=location.hash){var n=new HashChangeEvent("hashchange");n.oldURL=t,n.newURL=location.href,p.emit("hashchange",n)}e=location.hash,t=location.href},100)}function t(e){p.emit("hashchange",e)}var n=document.documentMode;n&&n>=8||void 0!=window.HashChangeEvent?window.addEventListener?window.addEventListener("hashchange",t,!1):window.attachEvent("onhashchange",t):(window.HashChangeEvent=function(e){this.isTrusted=!0,this.oldURL="",this.newURL="",this.type=e},e())}function s(){this.__keyList__={},this._watch()}function a(e){var t={routes:[]};this._routes=[],this.query=new s,e=Object.assign({},t,e);var n=e.routes;(c(n)||u(n))&&this.addRoute(n),this._init(),a.app=this}n(4);var h=n(1).EventEmitter,u=r("Object"),c=r("Array"),f=r("String"),l=r("Function"),p=new h,v=/#[^?]*\?(.+)$/,_=/#([^?]+)/;o(),s.prototype.add=function(e){var t=Object.assign({},{name:"",value:"",locked:!1,watch:function(e,t){}},e);if(!t.name||!t.value||"function"!=typeof t.watch)throw new Error("no name„ÄÅvalue or watch function.");this.__keyList__[t.name]=t,this.set(t.name,t.value)},s.prototype.remove=function(e){this.set(e,null)},s.prototype.get=function(e){return this.set(e)},s.prototype.set=function(e,t){if(f(e)&&""!=e){var n=location.hash;if(t=encodeURIComponent(t),e=encodeURIComponent(e),"undefined"===t){var r=n.match(new RegExp("&*\\b"+e+"=([^&]*)","i"));return r&&r.length&&r[1]?r[1]:null}if(!new RegExp("[?&]"+e+"=[^?]+").test(n))return location.hash=n+(/\?/.test(n)?"&":"?")+e+"="+t;location.hash=n.replace(new RegExp("([?&])("+e+"=)[^?&]+(&?)","g"),function(e,n,r,i){return""===t||"null"===t?"&"===n?i:i?n:"":n+r+t})}},s.prototype._watch=function(){var e=this;p.on("hashchange",function(t){if(/#.*\?/.test(t.newURL)){var n=i(t.newURL,v),r=i(t.oldURL,v);r!==n&&(n=n.split("&").map(function(e){return e=e.split("="),{name:e[0],value:e[1]}}),r=r.split("&").map(function(e){return e=e.split("="),{name:e[0],value:e[1]}}),n.forEach(function(t){var n=r.find(function(e){return e.name===t.name});if(n&&t.value!==n.value){var i=e.__keyList__[t.name].watch;l(i)?i.call(null,t.value,n.value):i.forEach(function(e){e.call(null,t.value,n.value)})}}))}})},s.prototype.watch=function(e,t){if(e&&f(e)&&l(t)){var n=this.__keyList__[e];n&&(c(n.watch)?n.watch.push(t):n.watch=[n.watch,t])}},a.prototype._init=function(){var e=this;if(p.on("hashchange",function(t){var n=i(t.newURL,_),r=i(t.oldURL,_);if(n!==r){var o=e._getCurrentRouter(r)[0],s=e._getCurrentRouter(n),a=s[0];o&&(o.leave(a&&a.path),p.emit("eachLeave",a&&a.path)),a&&(a.enter(o&&o.path),a.render(s[1]),p.emit("eachEnter",o&&o.path))}}),location.hash){var t=this._getCurrentRouter(),n=t[0];if(n)return n.enter(),p.emit("eachEnter"),void n.render(t[1])}var r=this._routes.find(function(e){return e.isDefault===!0&&!e._hasParams});r&&this.push(r.path)},a.prototype._getCurrentRouter=function(e){if(""===e)return[null,{}];if(void 0===e||null===e){var t=location.hash||"#/";if(!((e=t.match(/#([^?]+)/))&&e.length&&e[1]))return console.warn("wrong path:",t),[null,{}];e=e[1]}var n={};return[this._routes.find(function(t){return t._hasParams&&new RegExp(t._paramPath).test(e)?(e.replace(new RegExp(t._paramPath),function(){var e=[].slice.call(arguments,1,t._params.length+1);t._params.forEach(function(t,r){n[t]=e[r]})}),!0):t.path===e}),n]},a.prototype.getCurrentRouter=function(){return this._getCurrentRouter()},a.prototype.addRoute=function(e){var t=this,n={path:"",name:"",isDefault:!1,component:null,enter:function(){},leave:function(){},render:function(){}};u(e)&&(e=[Object.assign({},n,e)]),c(e)&&e.forEach(function(e){if(/^\//.test(e.path)||(e.path="/"+e.path),!t._routes.some(function(t){return e.path&&t.path===e.path})){if(/\/:([^\/])+/.test(e.path)){e._hasParams=!0;var r=[];e._paramPath=e.path.replace(/:([^\/]+)/g,function(){return r.push(arguments[1]),"([^/]+)"}),e._params=r}t._routes.push(Object.assign({},n,e))}})},a.prototype.push=function(e){var t={path:"",name:"",params:{},query:{}};if(f(e)&&(t.path=e.replace(/^\//,"")),u(e)&&(t=Object.assign({},t,e)),t.path||t.name){var n=[];for(var r in this.query.__keyList__)if(this.query.__keyList__.hasOwnProperty(r)){var i=this.query.__keyList__[r];!i.locked||r in t.query||(t.query[r]=this.query.get(r))}for(var o in t.query)t.query.hasOwnProperty(o)&&n.push(encodeURIComponent(o)+"="+encodeURIComponent(t.query[o]));n=n.join("&");var s="";if(t.path)s="#/"+t.path;else{var a=this._routes.find(function(e){return e.name===t.name});if(!a)return void console.warn("no get route name : ",t.name);if(a._hasParams){var h=a._paramPath.split("/([^/]+)");a._params.forEach(function(e){if(!(e in t.params))throw new Error("no params : ",e);s+=h.shift()+"/"+t.params[e]}),s+=h.join("")}else s=a.path}n&&(s+="?"+n),location.hash=s}},a.prototype.eachLeave=function(e){p.on("eachLeave",e)},a.prototype.eachEnter=function(e){p.on("eachEnter",e)},e.exports=a},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,h,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,h=0;h<i;h++)u[h].apply(this,a);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)},e.exports.EventEmitter=n},function(e,t){Array.prototype.forEach||(Array.prototype.forEach=function(e){var t,n;if(null==this)throw new TypeError("this is null or not defined");var r=Object(this),i=r.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),n=0;n<i;){var o;n in r&&(o=r[n],e.call(t,o,n,r)),n++}}),Array.prototype.map||(Array.prototype.map=function(e){var t,n,r;if(null==this)throw new TypeError("this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),n=new Array(o),r=0;r<o;){var s,a;r in i&&(s=i[r],a=e.call(t,s,r,i),n[r]=a),r++}return n}),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<n;){var o=t[i];if(e.call(r,o,i,t))return o;i++}}),Array.prototype.some||(Array.prototype.some=function(e){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),n=t.length>>>0,r=arguments.length>=2?arguments[1]:void 0,i=0;i<n;i++)if(i in t&&e.call(r,t[i],i,t))return!0;return!1})},function(e,t){"function"!=typeof Object.assign&&(Object.assign=function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n})},function(e,t,n){n(2),n(3)},function(e,t,n){e.exports=n(0)}])});